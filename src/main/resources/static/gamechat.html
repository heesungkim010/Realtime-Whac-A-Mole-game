<!DOCTYPE html>
<html>
<head>
    <title>Hello WebSocket</title>
    <link href="/webjars/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/main.css" rel="stylesheet">
    <!--The main.css can be omitted if you like, or you can create an empty one,
        just so the <link> can be resolved.-->
    <script src="/webjars/jquery/jquery.min.js"></script>
    <script src="/webjars/sockjs-client/sockjs.min.js"></script>
    <script src="/webjars/stomp-websocket/stomp.min.js"></script>
    <script src="/app1.js"></script>

</head>
<body>
<noscript><h2 style="color: #ff0000">Seems your browser doesn't support Javascript! Websocket relies on Javascript being
    enabled. Please enable
    Javascript and reload this page!</h2></noscript>

<div class = "game-map" id = "game-map">

</div>

<div id="main-content" class="container">

    <div class="row">
        <div id = "chat">
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <form class="form-inline">
                <div class="form-group">
                    <input type="text" id="chat-content" class="form-control" placeholder="chat message and press enter">
                </div>
                <button id="send" class="btn btn-default" type="submit">Send</button>
            </form>
        </div>
    </div>
</div>
    <script>
        connect_start()

        let step;
        for (step = 0; step < 25; step++) {
            $("#game-map").append("<div class='item' style='background-color: ivory' id ="+ step + ">" +"</div>")
        }

        $(function () {
            $( ".item" ).click( function() {
                checkAndPost('','',this)
            });
        });

        async function checkAndPost(url = '', data = {}, cur) {
            //1. check if current box is colored
            //2. if colored : post
            //   else: ignore
            // Default options are marked with *
            console.log(cur.id);
            console.log(cur.style.backgroundColor);
            cur.style.backgroundColor = "#00FF00";

            const response = await fetch(url, {
                method: 'POST', // *GET, POST, PUT, DELETE, etc.
                mode: 'cors', // no-cors, *cors, same-origin
                cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                credentials: 'include', // include, *same-origin, omit
                headers: {
                'Content-Type': 'application/json'
                // 'Content-Type': 'application/x-www-form-urlencoded',
                },
                redirect: 'follow', // manual, *follow, error
                referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                body: JSON.stringify(data), // body data type must match "Content-Type" header
            });
            result = await response.json()
            return result;
        }
    </script>

</body>
</html>